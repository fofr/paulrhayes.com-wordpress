(function(c){function i(a,b,d){d=k(b,d);b=a.currentTarget;if(!(1<a.which||a.metaKey)&&!(location.protocol!==b.protocol||location.host!==b.host)&&!(b.hash&&b.href.replace(b.hash,"")===location.href.replace(location.hash,"")))return b={url:b.href,container:c(b).attr("data-pjax"),clickedElement:c(b),fragment:null},c.pjax(c.extend({},b,d)),a.preventDefault(),!1}function k(a,b){a&&b?b.container=a:b=c.isPlainObject(a)?a:{container:a};b.container&&(b.container=l(b.container));return b}function l(a){a=c(a);
if(a.length){if(""!==a.selector&&a.context===document)return a;if(a.attr("id"))return c("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}c.fn.pjax=function(a,b){b=k(a,b);return this.live("click",function(a){return i(a,b)})};var d=c.pjax=function(a){var b=l(a.container),h=a.success||c.noop;delete a.success;a=c.extend(!0,{},d.defaults,a);c.isFunction(a.url)&&(a.url=a.url());a.context=b;a.success=function(e){if(a.fragment){var f=c(e).find(a.fragment);
if(f.length)e=f.children();else return window.location=a.url}else if(!c.trim(e)||/<html/i.test(e))return window.location=a.url;this.html(e);var j=document.title,g=c.trim(this.find("title").remove().text());!g&&a.fragment&&(g=f.attr("title")||f.data("title"));g&&(document.title=g);f={pjax:b.selector,fragment:a.fragment,timeout:a.timeout};g=c.param(a.data);"_pjax=true"!=g&&(f.url=a.url+(/\?/.test(a.url)?"&":"?")+g);a.replace?(d.active=!0,window.history.replaceState(f,document.title,a.url)):a.push&&
(d.active||(window.history.replaceState(c.extend({},f,{url:null}),j),d.active=!0),window.history.pushState(f,document.title,a.url));(a.replace||a.push)&&window._gaq&&_gaq.push(["_trackPageview"]);j=window.location.hash.toString();""!==j&&(window.location.href=j);h.apply(this,arguments)};var e=d.xhr;e&&4>e.readyState&&(e.onreadystatechange=c.noop,e.abort());d.options=a;d.xhr=c.ajax(a);c(document).trigger("pjax",[d.xhr,a]);return d.xhr},h=null;d.defaults={timeout:650,push:!0,replace:!1,data:{_pjax:!0},
type:"GET",dataType:"html",beforeSend:function(a,b){var i=this;b.async&&0<b.timeout&&(h=setTimeout(function(){var b=c.Event("pjax:timeout");i.trigger(b,[a,d.options]);!1!==b.result&&a.abort("timeout")},b.timeout),b.timeout=0);this.trigger("pjax:start",[a,d.options]);this.trigger("start.pjax",[a,d.options]);a.setRequestHeader("X-PJAX","true")},error:function(a,b){"abort"!==b&&(window.location=d.options.url)},complete:function(a){h&&clearTimeout(h);this.trigger("pjax:end",[a,d.options]);this.trigger("end.pjax",
[a,d.options])}};d.click=i;var m="state"in window.history,n=location.href;c(window).bind("popstate",function(a){var b=!m&&location.href==n;m=!0;if(!b&&(a=a.state)&&a.pjax)b=a.pjax,c(b+"").length?c.pjax({url:a.url||location.href,fragment:a.fragment,container:b,push:!1,timeout:a.timeout}):window.location=location.href});0>c.inArray("state",c.event.props)&&c.event.props.push("state");c.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);
c.support.pjax||(c.pjax=function(a){window.location=c.isFunction(a.url)?a.url():a.url},c.pjax.click=c.noop,c.fn.pjax=function(){return this})})(jQuery);
